# Running TCHSM in Intralabs


## Config

### TCHSM Configuration

To setup TCHSM you'll need the config files generated by the script on the TCHSM Repository. These confguration files need to be present on the nodes, preferably on `/etc/cryptoki_TCHSM.conf`  with the master node and on `/etc/TCHSM_node.conf` on the worker nodes.

You'll also need to have the OpenDNSSEC configuration files present in `/etc/opendnssec` on the master node.

## Installation

### TCHSM Master Node (OpenDNSSEC)
* Copy folder "docker-tchsm" on /etc or any place you like inside the node.
* Build docker images with the following commands:
```
docker build -t tchsm-lib-centos7 /path/to/docker-tchsm/lib/centos7
docker build -t tchsm-opendnssec /path/to/docker-tchsm/opendnssec
```
* Create docker container running OpenDNSSEC:
```
docker run --net=host -d -v /etc/opendnssec:/etc/opendnssec -v /etc/cryptoki_TCHSM.conf:/cryptoki_TCHSM.conf --name opendnssec tchsm-opendnssec
```
* You can see docker logs with the command: `docker logs -f opendnssec`


### TCHSM Node
* Copy folder "docker-tchsm" on /etc or any place you like inside the node.
* Build docker image with the following commands:
```
docker build -t tchsm-node-alpine /path/to/docker-tchsm/node/alpine
```
* Create docker container running OpenDNSSEC:
```
docker run --net=host -d -v /etc/TCHSM_node.conf:/TCHSM_node.conf --name node-tchsm tchsm-node-alpine -c /TCHSM_node.conf
```
* You can see docker logs with the command: `docker logs -f node-tchsm`

